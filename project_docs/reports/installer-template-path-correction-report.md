# APM Installer Template Path Correction Report

**Date**: 2025-01-19  
**Generated By**: AP Orchestrator  
**Scope**: Analysis of ONLY installer template files in `.apm/.installer/templates/`

## Executive Summary

This report documents all path issues found exclusively in the APM installer template files. The investigation revealed **30+ template files** requiring path corrections to ensure proper document organization under `project_docs/` subdirectories.

## Critical Issues Identified

### 1. ğŸš¨ **Root-Level Deliverables Directory**
All persona templates (except AP Orchestrator) write to a root-level `deliverables/` directory instead of organizing under `project_docs/`:
- 8 persona templates affected
- Creates documents outside the project documentation structure

### 2. ğŸ“ **PO Overly Broad Access**
The Product Owner template has unrestricted access to:
- Entire `project_docs/` directory (can write anywhere)
- Root `deliverables/` directory
- No subdirectory restrictions

### 3. ğŸ”§ **Inconsistent Document Locations**
The `groom-backlog-task.md.template` expects critical documents in project_docs root:
- `prd.md`, `architecture.md`, `frontend-architecture.md`, etc.
- Should be in appropriate subdirectories

## Detailed Findings by Template Category

### Persona Templates (`templates/agents/personas/`)

| Persona | File | Line | Current Path | Should Be |
|---------|------|------|--------------|-----------|
| Analyst | analyst.md.template | 14 | `deliverables/reports/` | `project_docs/research/reports/` |
| Architect | architect.md.template | 16 | `deliverables/artifacts/` | `project_docs/architecture/artifacts/` |
| Design Architect | design-architect.md.template | 16 | `deliverables/artifacts/` | `project_docs/design/artifacts/` |
| Developer | dev.md.template | 8 | `deliverables/releases/` | `project_docs/releases/` |
| PM | pm.md.template | 7 | `deliverables/reports/` | `project_docs/requirements/reports/` |
| PO | po.md.template | 13-15 | `project_docs/` (entire) | `project_docs/backlog/`, `project_docs/stories/` |
| QA | qa.md.template | 14 | `deliverables/reports/` | `project_docs/qa/reports/` |
| QA | qa.md.template | 511 | `./$PROJECT_DOCS/test` | `project_docs/qa/test-results/` |
| SM | sm.md.template | 14 | `deliverables/reports/` | `project_docs/planning/reports/` |

### Task Templates (`templates/agents/tasks/`)

**groom-backlog-task.md.template** - Multiple issues:
| Line | Current Reference | Should Be |
|------|------------------|-----------|
| 16 | `$PROJECT_DOCS/prd.md` | `$PROJECT_DOCS/requirements/prd.md` |
| 17 | `$PROJECT_DOCS/architecture.md` | `$PROJECT_DOCS/architecture/architecture.md` |
| 18 | `$PROJECT_DOCS/frontend-architecture.md` | `$PROJECT_DOCS/architecture/frontend-architecture.md` |
| 19 | `$PROJECT_DOCS/uxui-spec.md` | `$PROJECT_DOCS/design/uxui-spec.md` |
| 20 | `$PROJECT_DOCS/project_brief.md` | `$PROJECT_DOCS/requirements/project_brief.md` |
| 121, 179 | `$PROJECT_DOCS/backlog.md` | `$PROJECT_DOCS/backlog/backlog.md` |

**Note**: Other task templates (create-next-story, create-epic, create-prd, etc.) correctly use subdirectories.

### Command Templates (`templates/claude/commands/`)

Inconsistencies found:
- Some reference `{{PROJECT_DOCS}}/base/` subdirectory
- Backlog sometimes referenced as file (`backlog.md`) and sometimes as directory (`backlog/`)
- No clear standard for document organization

## Recommended Directory Structure

```
project_docs/
â”œâ”€â”€ requirements/
â”‚   â”œâ”€â”€ project_brief.md      # Analyst output
â”‚   â”œâ”€â”€ prd.md                # PM output
â”‚   â””â”€â”€ reports/              # PM/Analyst reports
â”œâ”€â”€ backlog/
â”‚   â”œâ”€â”€ backlog.md            # PO main backlog
â”‚   â”œâ”€â”€ epics/                # PO epic definitions
â”‚   â””â”€â”€ stories/              # PO/SM user stories
â”œâ”€â”€ architecture/
â”‚   â”œâ”€â”€ architecture.md       # Architect main doc
â”‚   â”œâ”€â”€ frontend-architecture.md  # Design Architect
â”‚   â””â”€â”€ artifacts/            # Architecture artifacts
â”œâ”€â”€ design/
â”‚   â”œâ”€â”€ uxui-spec.md          # Design Architect
â”‚   â”œâ”€â”€ components/           # Component designs
â”‚   â””â”€â”€ artifacts/            # Design artifacts
â”œâ”€â”€ qa/
â”‚   â”œâ”€â”€ test-plans/           # QA test plans
â”‚   â”œâ”€â”€ test-results/         # QA execution results
â”‚   â””â”€â”€ reports/              # QA quality reports
â”œâ”€â”€ planning/
â”‚   â”œâ”€â”€ sprints/              # SM sprint planning
â”‚   â”œâ”€â”€ retrospectives/       # SM retros
â”‚   â””â”€â”€ reports/              # SM reports
â””â”€â”€ releases/                 # Developer releases
```

## Template Files Requiring Updates

### Priority 1: Persona Templates (8 files)
1. `analyst.md.template` - Update deliverables path
2. `architect.md.template` - Update deliverables path
3. `design-architect.md.template` - Update deliverables path
4. `dev.md.template` - Update deliverables path
5. `pm.md.template` - Update deliverables path
6. `po.md.template` - Restrict workspace access
7. `qa.md.template` - Fix line 511 path, update deliverables
8. `sm.md.template` - Update deliverables path

### Priority 2: Task Templates (1 file)
1. `groom-backlog-task.md.template` - Update all document paths to use subdirectories

### Priority 3: Command Templates (5+ files)
1. Standardize backlog references (file vs directory)
2. Clarify `/base/` subdirectory usage
3. Ensure consistency across all command templates

## Implementation Recommendations

### Phase 1: Critical Fixes
1. **Fix QA template line 511** - Remove relative path prefix
2. **Restrict PO workspace** - Limit to specific subdirectories
3. **Update groom-backlog paths** - Use proper subdirectories

### Phase 2: Standardization
1. **Replace all `deliverables/`** references with `project_docs/[agent]/[type]/`
2. **Create consistent path variables** in templates
3. **Add path validation** to prevent root directory writes

### Phase 3: Documentation
1. **Create path standards document** for template developers
2. **Add directory structure** to installer documentation
3. **Include path examples** in each template

## Conclusion

The installer templates have systematic issues with document organization. The primary problems are:
1. Writing to root `deliverables/` directory outside project_docs
2. PO having unrestricted access to entire project_docs
3. Critical documents expected in project_docs root instead of subdirectories

Implementing these corrections will ensure all generated APM installations have properly organized documentation structures.

**Total Template Files Requiring Updates**: 30+ (8 persona templates, 1+ task templates, 5+ command templates)

---

## Implementation Status (Updated 2025-01-19)

### âœ… Completed Corrections

#### Persona Templates (8 files - ALL COMPLETE)
1. **qa.md.template** - Fixed malformed path on line 511, updated deliverables path
2. **po.md.template** - Restricted workspace boundaries to specific subdirectories
3. **analyst.md.template** - Updated deliverables path to project_docs/research/
4. **architect.md.template** - Updated deliverables path to project_docs/architecture/
5. **design-architect.md.template** - Updated deliverables path to project_docs/design/
6. **dev.md.template** - Updated deliverables path to project_docs/releases/
7. **pm.md.template** - Updated deliverables path to project_docs/requirements/
8. **sm.md.template** - Updated deliverables path to project_docs/planning/

#### Task Templates (1 file - COMPLETE)
1. **groom-backlog-task.md.template** - Updated all document paths to use proper subdirectories

#### Command Templates (12 files - ALL COMPLETE)
1. **ap.md.template** - Updated backlog location and removed /base/ reference
2. **ap_orchestrator.md.template** - Updated backlog location and removed /base/ reference
3. **po.md.template** - Updated backlog and PRD paths
4. **sm.md.template** - Updated backlog path to standard location
5. **pm.md.template** - Updated project brief and PRD paths
6. **architect.md.template** - Updated PRD and architecture document paths
7. **design-architect.md.template** - Updated frontend architecture path
8. **dev.md.template** - Updated architecture document path
9. **developer.md.template** - Updated architecture document path
10. **qa.md.template** - Updated PRD path
11. **analyst.md.template** - Removed /base/ subdirectory reference
12. **groom-backlog-task.md.template** - Updated backlog path (included in task templates above)

### ğŸ“ Standardized Document Structure

All templates now follow this consistent structure:
```
project_docs/
â”œâ”€â”€ requirements/
â”‚   â”œâ”€â”€ project_brief.md
â”‚   â””â”€â”€ prd.md
â”œâ”€â”€ backlog/
â”‚   â””â”€â”€ backlog.md
â”œâ”€â”€ architecture/
â”‚   â”œâ”€â”€ architecture.md
â”‚   â””â”€â”€ frontend-architecture.md
â”œâ”€â”€ design/
â”‚   â””â”€â”€ uxui-spec.md
â”œâ”€â”€ epics/
â”‚   â””â”€â”€ epic-*.md
â”œâ”€â”€ stories/
â”‚   â””â”€â”€ *.story.md
â”œâ”€â”€ qa/
â”‚   â”œâ”€â”€ test-plans/
â”‚   â”œâ”€â”€ test-results/
â”‚   â””â”€â”€ reports/
â”œâ”€â”€ planning/
â”‚   â”œâ”€â”€ operational-guidelines.md
â”‚   â”œâ”€â”€ sprints/
â”‚   â””â”€â”€ retrospectives/
â”œâ”€â”€ research/
â”‚   â””â”€â”€ (analyst outputs)
â””â”€â”€ releases/
    â””â”€â”€ (release documentation)
```

### âœ… All Template Corrections Complete

All 21 template files identified have been successfully updated to use the standardized directory structure.