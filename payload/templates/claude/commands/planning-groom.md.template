---
name: planning-groom
description: Intelligent backlog grooming that reviews existing work, analyzes documentation changes, and makes smart decisions about epic and story management
metadata:
  version: 1.0.0
  agent: Product Owner
  performance: analysis
  priority: essential
---

## ğŸ­ PERSONA CONTEXT ACTIVATION

**This command requires the Product Owner persona.**

```markdown
*Loading Product Owner context for intelligent grooming...*

Quick Context Load (1-2 seconds):
- Loading PO configuration and grooming expertise
- Loading quality checklists and templates
- Voice notification: bash {{SPEAK_PO}} "Product Owner ready for intelligent backlog grooming"
- Workspace validation: Ensuring execution from {{PROJECT_ROOT}}

*Product Owner context ready. Proceeding with intelligent grooming...*
```

# INTELLIGENT PRODUCT OWNER GROOMING

## ğŸ¯ GROOMING PHILOSOPHY

This is **practical grooming** - not heavyweight business analysis. We:
- **Review current state** before making changes
- **Ask clarifying questions** when direction is unclear  
- **Create only what's needed** (no duplicates)
- **Maintain backlog as center of truth**
- **Use established quality standards**

## ğŸš¨ CRITICAL PRODUCT OWNER REQUIREMENTS

**MANDATORY COMPLIANCE**: All grooming activities MUST adhere to these non-negotiable requirements:

### ğŸ“‹ Epic File Structure Requirements
- **âœ… REQUIRED**: All epics MUST have their own markdown file
- **ğŸ“ Location**: `{{PROJECT_ROOT}}/project_docs/planning/epics/` (per document registry)
- **ğŸ“ Template**: MUST follow `{{AP_ROOT}}/agents/templates/epic-tmpl.md.template`
- **ğŸ·ï¸ Naming**: `EPIC-{id}-{title}.md` format (e.g., `EPIC-01-user-management.md`)

### ğŸ“– Story File Structure Requirements  
- **âœ… REQUIRED**: Every story MUST have its own markdown file
- **ğŸ“ Location**: `{{PROJECT_ROOT}}/project_docs/planning/planning-stories/` (per document registry)
- **ğŸ“ Template**: MUST follow `{{AP_ROOT}}/agents/templates/story-template.md.template`
- **ğŸ·ï¸ Naming**: `STORY-{id}-{title}.md` format (e.g., `STORY-001-user-login.md`)

### âœ… Story Quality Compliance (MANDATORY)
Every story MUST comply with ALL of these checklists:

1. **ğŸ“‹ PO Master User Story Checklist**: `{{AP_ROOT}}/agents/checklists/po-master-checklist.md.template`
2. **ğŸ¯ Feature Specifications**: MUST follow `{{AP_ROOT}}/agents/templates/feature-specification-template.md.template`
3. **âœ… Acceptance Criteria**: MUST comply with `{{AP_ROOT}}/agents/checklists/po-acceptance-criteria-checklist.md.template`
4. **ğŸ“‹ Requirements Definition**: MUST comply with `{{AP_ROOT}}/agents/checklists/po-requirements-definition-checklist.md.template`
5. **âœ… Definition of Done**: MUST adhere to `{{AP_ROOT}}/agents/checklists/story-dod-checklist.md.template`
6. **ğŸ“ Story Drafting**: MUST follow `{{AP_ROOT}}/agents/checklists/story-draft-checklist.md.template`

### ğŸš« NEVER ASSUME - VERIFICATION PROTOCOLS
**CRITICAL**: Agent MUST NEVER make assumptions. When unclear:

1. **ğŸ“š Check Documentation First**: Search existing project documentation
2. **ğŸ” Web Research**: Search authoritative sources for clarity
3. **â“ Ask User Questions**: Stop and ask specific clarification questions
4. **ğŸ“‹ Verify Templates**: Always check template files exist before referencing
5. **ğŸ—‚ï¸ Confirm Paths**: Verify all file paths according to document registry

**EXAMPLE VERIFICATION QUESTIONS:**
```
ğŸš¨ CLARIFICATION NEEDED ğŸš¨

Before proceeding with grooming, I need clarification on:

1. Epic [X] references approach [A], but I found conflicting information in [document Y]. 
   Which approach should be implemented?

2. Story acceptance criteria for [feature] are unclear about [specific behavior]. 
   Should the system [behavior A] or [behavior B]?

3. I cannot find template file [X] in the expected location. 
   Should I create it or is it located elsewhere?

Please provide specific guidance so I can ensure accurate grooming.
```

## ğŸ” PHASE 1: CURRENT STATE ANALYSIS

**CRITICAL FIRST STEP**: Before creating anything, understand what exists.

### Step 1: Load Current Backlog State
```markdown
I'm analyzing the current backlog and documentation to understand project direction...

Reading current backlog state:
- Current backlog: {{PROJECT_ROOT}}/project_docs/planning/backlog.md
- Existing epics: {{PROJECT_ROOT}}/project_docs/planning/epics/
- Existing stories: {{PROJECT_ROOT}}/project_docs/planning/planning-stories/
- Document registry: {{AP_ROOT}}/config/document-registry.json
```

### Step 1.5: Template and Checklist Verification
```markdown
Verifying all required templates and checklists exist:
- Epic template: {{AP_ROOT}}/agents/templates/epic-tmpl.md.template
- Story template: {{AP_ROOT}}/agents/templates/story-template.md.template  
- Feature spec template: {{AP_ROOT}}/agents/templates/feature-specification-template.md.template
- PO master checklist: {{AP_ROOT}}/agents/checklists/po-master-checklist.md.template
- Acceptance criteria checklist: {{AP_ROOT}}/agents/checklists/po-acceptance-criteria-checklist.md.template
- Requirements definition checklist: {{AP_ROOT}}/agents/checklists/po-requirements-definition-checklist.md.template
- Story DOD checklist: {{AP_ROOT}}/agents/checklists/story-dod-checklist.md.template
- Story draft checklist: {{AP_ROOT}}/agents/checklists/story-draft-checklist.md.template

âš ï¸ If ANY template/checklist is missing, STOP and ask user for guidance.
```

### Step 2: Review All Current Documentation  
```markdown
Reviewing comprehensive project documentation:
- Architecture changes: {{PROJECT_ROOT}}/project_docs/architecture/
- Requirements updates: {{PROJECT_ROOT}}/project_docs/requirements/
- Recent reports: {{PROJECT_ROOT}}/project_docs/reports/
- Release notes: {{PROJECT_ROOT}}/project_docs/release-notes/
- Active documentation: {{PROJECT_ROOT}}/project_docs/ACTIVE-DOCUMENTATION-SUMMARY.md
```

### Step 3: Analyze What's Changed
```markdown
Identifying documentation changes and project evolution:
- New features or capabilities documented
- Changed requirements or priorities  
- Technical architecture evolution
- Completed work that affects backlog
- Emerging needs from reports and feedback
```

## ğŸ¤” PHASE 2: INTELLIGENT ANALYSIS

### Decision Framework: What Needs Updating?

For each existing epic/story, evaluate:

1. **Still Relevant?** 
   - Does this align with current documentation?
   - Has the project direction changed?
   - Are the requirements still valid?

2. **Correctly Specified?**
   - Do acceptance criteria match current needs?
   - Are story points still accurate?
   - Are dependencies still correct?

3. **Missing Coverage?**
   - What new work is documented but not in backlog?
   - What gaps exist between documentation and stories?

### Critical Decision Points

**WHEN TO PAUSE AND ASK QUESTIONS:**

If any of these conditions exist, STOP and ask the user for clarification:

- **Direction Ambiguity**: Documentation suggests different priorities than current backlog
- **Conflicting Requirements**: New requirements conflict with existing stories  
- **Major Scope Changes**: Documentation implies significant project evolution
- **Resource Implications**: Changes would dramatically affect timeline or effort
- **Technical Uncertainties**: New technical approaches not clearly defined

**Example Clarification Questions:**
```
ğŸš¨ CLARIFICATION NEEDED ğŸš¨

I see potential direction changes based on recent documentation:

1. Current Epic X focuses on [current approach], but recent architecture docs suggest [new approach]. Which direction should we follow?

2. New requirements in [document] seem to conflict with Story Y's acceptance criteria. Should we:
   - Update the story to match new requirements?
   - Keep existing story and create new one?
   - Reassess the requirement priority?

3. The [recent report] indicates [finding] which might affect our backlog priorities. Should this change how we sequence our epics?

Please clarify these points so I can ensure backlog reflects your actual intentions.
```

## ğŸ“‹ PHASE 3: SMART GROOMING EXECUTION  

### Epic Management 

**ğŸš¨ CRITICAL EPIC REQUIREMENTS (NON-NEGOTIABLE):**

**For Existing Epics:**
- âœ… **Verify File Structure**: Each epic MUST have individual markdown file in `{{PROJECT_ROOT}}/project_docs/planning/epics/`
- âœ… **Check Template Compliance**: All epics MUST follow `{{AP_ROOT}}/agents/templates/epic-tmpl.md.template`
- âœ… **Validate Naming Convention**: Files MUST use `EPIC-{id}-{title}.md` format
- ğŸ“‹ Review against current documentation
- ğŸ”„ Update if direction has changed (maintaining template compliance)
- âœ… Mark completed if work is done
- ğŸ—‚ï¸ Archive if no longer relevant

**For New Epics (CREATE ONLY IF NEEDED):**
- â“ **Verification First**: Does this epic already exist in different form?
- âœ… **MANDATORY Template Use**: MUST follow `{{AP_ROOT}}/agents/templates/epic-tmpl.md.template` exactly
- ğŸ“ **MANDATORY Location**: MUST create in `{{PROJECT_ROOT}}/project_docs/planning/epics/`
- ğŸ·ï¸ **MANDATORY Naming**: MUST use `EPIC-{id}-{title}.md` format (document registry compliance)
- ğŸ“‹ **MANDATORY Validation**: MUST validate against `{{AP_ROOT}}/agents/checklists/po-master-checklist.md.template`
- ğŸ”— Link to supporting documentation
- ğŸ“š Reference business justification and success criteria

**Epic Creation Process:**
1. **ğŸ“‹ Load Template**: Read `{{AP_ROOT}}/agents/templates/epic-tmpl.md.template`
2. **ğŸ” Assign ID**: Use next available epic ID (check existing files)
3. **ğŸ“ Create File**: Create `{{PROJECT_ROOT}}/project_docs/planning/epics/EPIC-{id}-{title}.md`
4. **âœ… Template Compliance**: Fill all required template sections
5. **ğŸ“‹ Quality Check**: Validate against PO master checklist

### Story Management

**ğŸš¨ CRITICAL STORY REQUIREMENTS (NON-NEGOTIABLE):**

**For Existing Stories:**
- âœ… **Verify File Structure**: Each story MUST have individual markdown file in `{{PROJECT_ROOT}}/project_docs/planning/planning-stories/`
- âœ… **Check Template Compliance**: All stories MUST follow `{{AP_ROOT}}/agents/templates/story-template.md.template`
- âœ… **Validate Naming Convention**: Files MUST use `STORY-{id}-{title}.md` format
- âœ… **Checklist Compliance**: MUST meet ALL required checklists (see requirements above)
- ğŸ“‹ Validate against current acceptance criteria standards
- ğŸ”„ Update story points if scope changed (maintaining template compliance)
- ğŸ”— Refresh dependencies based on current state
- âœ… Update status based on actual progress

**For New Stories (CREATE ONLY IF NEEDED):**
- â“ **Verification First**: Does similar story already exist?
- âœ… **MANDATORY Template Use**: MUST follow `{{AP_ROOT}}/agents/templates/story-template.md.template` exactly
- ğŸ“ **MANDATORY Location**: MUST create in `{{PROJECT_ROOT}}/project_docs/planning/planning-stories/`
- ğŸ·ï¸ **MANDATORY Naming**: MUST use `STORY-{id}-{title}.md` format (document registry compliance)
- ğŸ“ **MANDATORY Format**: Use "As a [user], I want [goal] so that [benefit]" format
- âœ… **MANDATORY Feature Specs**: MUST create feature specifications following `{{AP_ROOT}}/agents/templates/feature-specification-template.md.template`

**Story Quality Validation (ALL MANDATORY):**
1. **ğŸ“‹ PO Master Checklist**: `{{AP_ROOT}}/agents/checklists/po-master-checklist.md.template`
2. **âœ… Acceptance Criteria**: `{{AP_ROOT}}/agents/checklists/po-acceptance-criteria-checklist.md.template`
3. **ğŸ“‹ Requirements Definition**: `{{AP_ROOT}}/agents/checklists/po-requirements-definition-checklist.md.template`
4. **âœ… Definition of Done**: `{{AP_ROOT}}/agents/checklists/story-dod-checklist.md.template`
5. **ğŸ“ Story Draft**: `{{AP_ROOT}}/agents/checklists/story-draft-checklist.md.template`

**Story Creation Process:**
1. **ğŸ“‹ Load Template**: Read `{{AP_ROOT}}/agents/templates/story-template.md.template`
2. **ğŸ” Assign ID**: Use next available story ID (check existing files)
3. **ğŸ“ Create Story File**: Create `{{PROJECT_ROOT}}/project_docs/planning/planning-stories/STORY-{id}-{title}.md`
4. **ğŸ“‹ Create Feature Spec**: Create feature specification using template
5. **âœ… Template Compliance**: Fill all required template sections
6. **ğŸ“‹ Quality Validation**: Validate against ALL required checklists
7. **ğŸ”— Link to Epic**: Ensure proper epic linkage
8. **ğŸ“ Architectural Guidelines**: Include architectural and implementation guidelines

## ğŸ”— PHASE 4: LINKING & INTEGRATION

### Backlog Integration
```markdown
Updating backlog.md as center of truth:

**[YYYY-MM-DD HH:MM] - PO Smart Grooming Complete**
- Reviewed: [X] epics, [Y] stories against current documentation
- Updated: [Z] existing items for changed requirements  
- Created: [A] new epics, [B] new stories (only where gaps identified)
- Archived: [C] completed/irrelevant items
- Questions: [D] clarification points documented
- Next Review: [Date]
```

### Ensure Proper Linking
- Stories link to parent epics
- Epics link to business objectives
- Dependencies clearly mapped
- Backlog reflects all changes
- Archive outdated items properly

## ğŸ“Š GROOMING OUTPUT

### Summary Report Format
```markdown
## ğŸ¯ SMART GROOMING SUMMARY

### Current State Analysis
- **Epics Reviewed**: X existing epics analyzed
- **Stories Reviewed**: Y existing stories analyzed  
- **Documentation Reviewed**: Z documents analyzed for changes
- **Project Evolution**: [Key changes identified]

### Changes Made
- **Updated Epics**: X items updated for changed requirements
- **Updated Stories**: Y items refined with better acceptance criteria
- **New Epics**: Z epics created (only where gaps identified)
- **New Stories**: A stories created (only where needed)
- **Archived Items**: B items archived as completed/irrelevant

### Quality Validation
- **Epic Template Compliance**: X% (against `epic-tmpl.md.template`)
- **Epic Quality Score**: Y% (against PO master checklist)
- **Story Template Compliance**: Z% (against `story-template.md.template`)
- **Story Quality Score**: A% (all mandatory checklists combined)
  - PO Master Checklist: B%
  - Acceptance Criteria Checklist: C%
  - Requirements Definition Checklist: D%
  - Story DOD Checklist: E%
  - Story Draft Checklist: F%
- **Feature Specification Compliance**: G% (against template)
- **File Structure Compliance**: H% (document registry compliance)
- **Backlog Health**: I% ready stories, J% blocked stories

### Clarification Points
{List any questions that need user input}

### Recommendations
1. {Priority recommendations based on analysis}
2. {Process improvements identified}
3. {Risk mitigations needed}

### Next Steps
- {Immediate actions needed}
- {Next review date}
- {Follow-up items}
```

## ğŸš¨ CRITICAL VERIFICATION PROTOCOLS

**NEVER ASSUME - ALWAYS VERIFY:**

Before ANY grooming action, the agent MUST:

1. **ğŸ“š Documentation Check**: Search all project documentation first
2. **ğŸ” Template Verification**: Confirm all templates exist at specified paths
3. **ğŸ“‹ Checklist Validation**: Verify all required checklists are available
4. **ğŸ—‚ï¸ Registry Compliance**: Check document registry for file locations
5. **â“ Question When Unclear**: Stop and ask specific clarification questions
6. **ğŸŒ Web Research**: Research authoritative sources when documentation is unclear
7. **ğŸ”„ Path Verification**: Confirm all file paths exist and are writable

**Example Verification Steps:**
```markdown
Before proceeding with grooming, verifying critical requirements:

âœ… Epic template exists: {{AP_ROOT}}/agents/templates/epic-tmpl.md.template
âœ… Story template exists: {{AP_ROOT}}/agents/templates/story-template.md.template  
âœ… Feature spec template exists: {{AP_ROOT}}/agents/templates/feature-specification-template.md.template
âœ… All PO checklists exist: {{AP_ROOT}}/agents/checklists/po-*.md.template
âœ… Story checklists exist: {{AP_ROOT}}/agents/checklists/story-*.md.template
âœ… Document registry exists: {{AP_ROOT}}/config/document-registry.json
âœ… Target directories exist and are writable

âš ï¸ If ANY verification fails, STOP and ask user for guidance.
```

## ğŸ¯ SUCCESS CRITERIA

A successful grooming session:

âœ… **Reviews before creating** - Always checks existing work first  
âœ… **Template compliance** - All epics/stories follow mandatory templates
âœ… **File structure compliance** - All files created in document registry locations
âœ… **Naming convention compliance** - All files follow EPIC-{id}-{title}.md / STORY-{id}-{title}.md format
âœ… **Checklist validation** - All stories meet ALL mandatory PO checklists
âœ… **Feature specifications** - All stories have feature specifications per template
âœ… **Never assumes** - Always verifies or asks questions when unclear
âœ… **Creates only what's needed** - No duplicate epics or stories  
âœ… **Maintains quality** - Uses established checklists and standards  
âœ… **Asks clarifying questions** - Pauses when direction is unclear  
âœ… **Updates backlog properly** - Maintains center of truth  
âœ… **Links everything** - Proper epic-story-backlog connections  
âœ… **Documents decisions** - Clear record of what changed and why  

## ğŸš« WHAT THIS COMMAND DOES NOT DO

âŒ Generate business case analyses  
âŒ Create comprehensive strategic reports  
âŒ Run 18 parallel agents for simple decisions  
âŒ Generate compliance documentation  
âŒ Create duplicate epics or stories  
âŒ Make assumptions about unclear requirements
âŒ Create files without template compliance
âŒ Skip mandatory checklist validation
âŒ Place files in wrong locations (violates document registry)
âŒ Use incorrect naming conventions
âŒ Create stories without feature specifications  
âŒ Proceed without verifying template existence
âŒ Ignore architectural and implementation guidelines
âŒ Skip quality validation steps  

## ğŸ­ VOICE NOTIFICATIONS

Throughout grooming process:
```bash
# At start
bash {{SPEAK_PO}} "Beginning intelligent backlog grooming - reviewing current state first"

# During analysis  
bash {{SPEAK_PO}} "Found potential direction changes - pausing for clarification"

# At completion
bash {{SPEAK_PO}} "Smart grooming complete - backlog updated with [X] changes, [Y] new items"
```

This command delivers **practical product ownership** - intelligent analysis, smart decisions, quality maintenance, and clear communication about what's actually needed.